module(load="imfile" PollingInterval="10") # needs to be done just once
module(load="omzmq3") # for listening to /dev/log

input(type="imfile"
      file="/usr/local/nagios/var/test.log"
      tag="nagios-json"
      ruleset="nagios-json")

template(name="nagios-json-format" type="list") {
  property(name="msg" spifno1stsp="on" )
  property(name="msg" droplastlf="on" )
  constant(value="\n")
}

ruleset(name="nagios-json") {
  action(type="omzmq3" sockType="PUB" action="BIND" description="tcp://*:11515" template="nagios-json-format")
}


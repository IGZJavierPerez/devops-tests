module(load="imfile" PollingInterval="10") # needs to be done just once
module(load="omzmq3") # for listening to /dev/log

input(type="imfile"
      file="/usr/local/nagios/var/nagios.log"
      tag="nagios-syslog"
      ruleset="nagios-syslog")

template(name="nagios-syslog-format" type="list") {
    property(name="timestamp" dateFormat="rfc3339")
    constant(value=" ")
    property(name="hostname")
    constant(value=" ")
    property(name="syslogtag")
    property(name="msg" spifno1stsp="on" )
    property(name="msg" droplastlf="on" )
    constant(value="\n")
}

ruleset(name="nagios-syslog") {
	action(type="omzmq3" sockType="PUB" action="BIND" description="tcp://*:11514" template="nagios-syslog-format")
}

module(load="imzmq3")
module(load="omelasticsearch") # for outputting to Elasticsearch
input(type="imzmq3" action="BIND" socktype="PULL" description="tcp://*:11514" ruleset="remote")

template(name="logstash-index"
  type="list") {
    constant(value="logstash-")
    property(name="timereported" dateFormat="rfc3339" position.from="1" position.to="4")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="6" position.to="7")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="9" position.to="10")
}

template(name="bunyan-syslog"
  type="list") {
    property(name="msg")
}

ruleset(name="remote") {
	# this is where we actually send the logs to Elasticsearch (localhost:9200 by default)
	action(type="omelasticsearch"
	    server="elasticsearch"
	    template="bunyan-syslog"
	    searchIndex="logstash-index"
	    dynSearchIndex="on")
}
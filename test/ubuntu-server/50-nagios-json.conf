module(load="imzmq3")
module(load="omelasticsearch") # for outputting to Elasticsearch
input(type="imzmq3" action="CONNECT" socktype="SUB" description="tcp://client:11515" subscribe="" ruleset="nagios-json")

template(name="logstash-index"
  type="list") {
    constant(value="logstash-")
    property(name="timereported" dateFormat="rfc3339" position.from="1" position.to="4")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="6" position.to="7")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="9" position.to="10")
}

template(name="nagios-json"
  type="list") {
    property(name="msg")
}

ruleset(name="nagios-json") {
  # this is where we actually send the logs to Elasticsearch (localhost:9200 by default)
  action(type="omelasticsearch"
      server="elasticsearch"
      template="nagios-json"
      searchIndex="logstash-index"
      dynSearchIndex="on")
}